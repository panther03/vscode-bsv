$schema: 'https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json'
name: Bluespec SystemVerilog
patterns:
  - include: '#whitespace'
  - include: '#keywords'
  - include: '#literal'
  
  - include: '#identifier'
repository:

#  MACROS:
# [\p{Alpha}\d\$_]  identifier character
# (?:\b\p{Lower}[\p{Alpha}\d\$_]*\b)  LOWER_IDENTIFIER
# (?:\b\p{Upper}[\p{Alpha}\d\$_]*\b)  UPPER_IDENTIFIER

  # TOP LEVEL 
  whitespace:
    patterns:
      # - include: '\s+'
      - include: '#block_comment'
      - include: '#single_comment'
      - include: '#attribute'

  identifier:
    patterns:
      - include: '#system_task'
      - include: '#type'
      - include: '#lower_identifier'

  keywords:
    patterns:
      - name: keyword.control.bluespec,
        match: \b(if|while|for|return)\b

  literal:
    patterns:
      - include: '#string'
      - include: '#real'
      - include: '#integer'

  string:
    name: string.quoted.double.bluespec
    begin: '"'
    end: '"'
    patterns:
      - name: constant.character.escape.bluespec
        match: '\\.'

  single_comment:
    name: comment.line.double-slash.bluespec
    match: '//.*'

  block_comment:
    name: comment.block.bluespec
    begin: '/\*'
    end: '\*/'

  attribute:  # e.g. (* synthesize *)
    name: comment.line.preprocessor.bluespec
    match: '\(\* .* \*\)'




  # upper_identifier:  # unused
  #   name: entity.name.type.bluespec
  #   match: (?:\b\p{Upper}[\p{Alpha}\d\$_]*\b) 
  
  type:
    name: entity.name.type.bluespec
    match: (?:\b\p{Upper}[\p{Alpha}\d\$_]*\#?) 
  
  lower_identifier:
    name: variable.bluespec
    match: (?:\b\p{Lower}[\p{Alpha}\d\$_]*\b) 
  
  system_task:
    name: support.function.bluespec
    match: (?:\$[\p{Alpha}\d\$_]*\b) 



  integer:
    patterns:
      - name: constant.numeric.bluespec
        match: \d*'(?:d[\d_]+|(h|x)[\h_]+|o[0-7_]+|b[01_]+)\b  # 32'd2424 kind
      - name: constant.numeric.bluespec
        match: '\b\d+\b'  # normal kind
  
  real:
    patterns:
      - name: constant.numeric.bluespec
        match: '\b\d[\d_]*(?:\.[\d_]+)?(?:[Ee][+-]?[\d_]+)?\b'

scopeName: source.bsv